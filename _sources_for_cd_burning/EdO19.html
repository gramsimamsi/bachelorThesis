<!DOCTYPE html>
<!-- saved from url=(0061)https://edoverflow.com/2019/ci-knew-there-would-be-bugs-here/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="viewport" content="width=device-width">
  <title>EdOverflow | “CI Knew There Would Be Bugs Here” — Exploring Continuous Integration Services as a Bug Bounty Hunter</title>
  <!-- Search Engine -->
<meta name="description" content="When it comes to bug bounty hunting and finding exciting areas to explore, it is vital to familiarise yourself with the technologies vendors, and companies rely on. One particularly interesting environment that caught our eye was popular integrations used by various open-source projects, primarily as part of their development life cycle. Some continuous-integration services turned out to be extremely rewarding for us as bug bounty hunters.">
<meta name="image" content="https://edoverflow.com/assets/img/frog.png">
<!-- Schema.org for Google -->
<meta itemprop="name" content="“CI Knew There Would Be Bugs Here” — Exploring Continuous Integration Services as a Bug Bounty Hunter">
<meta itemprop="description" content="When it comes to bug bounty hunting and finding exciting areas to explore, it is vital to familiarise yourself with the technologies vendors, and companies rely on. One particularly interesting environment that caught our eye was popular integrations used by various open-source projects, primarily as part of their development life cycle. Some continuous-integration services turned out to be extremely rewarding for us as bug bounty hunters.">
<meta itemprop="image" content="https://edoverflow.com/assets/img/frog.png">
<!-- Twitter -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="“CI Knew There Would Be Bugs Here” — Exploring Continuous Integration Services as a Bug Bounty Hunter">
<meta name="twitter:description" content="When it comes to bug bounty hunting and finding exciting areas to explore, it is vital to familiarise yourself with the technologies vendors, and companies rely on. One particularly interesting environment that caught our eye was popular integrations used by various open-source projects, primarily as part of their development life cycle. Some continuous-integration services turned out to be extremely rewarding for us as bug bounty hunters.">
<meta name="twitter:site" content="@EdOverflow">
<meta name="twitter:creator" content="@EdOverflow">
<meta name="twitter:image:src" content="https://edoverflow.com/assets/img/frog.png">
<!-- Open Graph general (Facebook, Pinterest &  Google+) -->
<meta name="og:title" content="“CI Knew There Would Be Bugs Here” — Exploring Continuous Integration Services as a Bug Bounty Hunter">
<meta name="og:description" content="When it comes to bug bounty hunting and finding exciting areas to explore, it is vital to familiarise yourself with the technologies vendors, and companies rely on. One particularly interesting environment that caught our eye was popular integrations used by various open-source projects, primarily as part of their development life cycle. Some continuous-integration services turned out to be extremely rewarding for us as bug bounty hunters.">
<meta name="og:image" content="https://edoverflow.com/assets/img/frog.png">
<meta name="og:url" content="https://edoverflow.com">
<meta name="og:site_name" content="EdOverflow">
<meta name="og:locale" content="en_Us">
<meta name="og:type" content="website">
<meta name="theme-color" content="#626cfc">

  <link rel="stylesheet" href="./EdO19_files/bulma.css">
  <link rel="stylesheet" type="text/css" href="./EdO19_files/stylesheet.css">
  <link rel="shortcut icon" href="https://edoverflow.com/assets/img/frog.png">
  <link href="./EdO19_files/classic-10_7.css" rel="stylesheet" type="text/css">
  <style>
    #mc_embed_signup {
      background: #fff;
      clear: left;
      font: 14px Helvetica, Arial, sans-serif;
      max-width: 500px;
      display: block;
      margin: 0 auto;
    }

    .hero {
      background: url("https://user-images.githubusercontent.com/18099289/56800082-83bab300-681a-11e9-80b7-729154bee59f.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    .blog {
      border-top: 0;
    }

    .hero.is-medium .hero-body {
      padding-bottom: 3.5rem;
    }

    .hero-head .navbar-burger {
      height: initial;
      align-items: stretch;
    }

    .hero-foot img {
      display: block;
      margin: 0 auto;
    }

    img {
      display: block;
      margin: 0 auto;
    }
  </style>
</head>

<body class="index">
  <nav class="navbar">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item" href="https://edoverflow.com/">
          Home
        </a>
      </div>
    </div>
  </nav>
  <section class="hero is-medium is-bold">
    <div class="hero-body">
      <div class="container">
        <h1 class="title">“CI Knew There Would Be Bugs Here” — Exploring Continuous Integration Services as a Bug Bounty Hunter</h1>
        
        <span>Apr 26, 2019</span>
      </div>
    </div>
    <div class="hero-foot">
      <nav class="tabs">
        <div class="container">
          <img src="./EdO19_files/56801659-48ba7e80-681e-11e9-89be-f58e0473feb4.png">
        </div>
      </nav>
    </div>
    
  </section>
  <section class="section blog">
    <div class="content">
      <p>When it comes to bug bounty hunting and finding exciting areas to explore, it is vital to familiarise yourself with the technologies that vendors and companies rely on. One particularly interesting environment that caught our eye was popular integrations used by various open-source projects, primarily as part of their development life cycle. Some prime examples of continuous-integration services (“CI services”) including <a href="https://travis-ci.org/">Travis CI</a>, <a href="https://circleci.com/">Circle CI</a>, and <a href="https://about.gitlab.com/product/continuous-integration/">GitLab CI</a> turned out to be extremely rewarding for us as bug bounty hunters.</p>

<p><img src="./EdO19_files/56799241-d3987a80-6818-11e9-9f31-4696e56bac02.png" alt="image"></p>

<p>We set out to automate fetching and searching large data sets from these CI services. This technical write-up will touch on the numerous challenges we faced, how we reduced the number of false-positives in our searches, notable findings, and finally, list some tricks we picked up along the way.</p>

<p>The team that worked on this research includes Justin Gardner (<a href="https://twitter.com/Rhynorater">@Rhynorater</a>), Corben Leo (<a href="https://twitter.com/hacker_">@hacker_</a>), and EdOverflow (<a href="https://twitter.com/EdOverflow">@EdOverflow</a>) — with some testing and helpful suggestions by Karim Rahal (<a href="https://twitter.com/KarimPwnz">@KarimPwnz</a>), <a href="https://twitter.com/streaak">@streaak</a>, <a href="https://twitter.com/d0nutptr">@d0nutptr</a>, and BBAC.</p>

<h2 id="introduction-to-continuous-integration-services">Introduction to continuous-integration services</h2>

<p>Continuous integration (CI) is the practice of committing code-changes and automatically building and testing every change. Nowadays, it is rare not to stumble across an open-source project that does not use a continuous-integration service at some point in the development cycle. The various services out there offer straightforward set-up configuration steps and beautiful interfaces for quickly testing and building code continuously.</p>

<figure>
    <img src="./EdO19_files/56799279-e6ab4a80-6818-11e9-8933-6d010c0f09fb.png">
    <figcaption>/r/dataisugly/ candidate right here.</figcaption>
</figure>

<p>The <a href="https://github.com/securitytxt/security-txt">security.txt project</a>, for instance, uses Travis CI to build new draft documents whenever a commit is pushed. This allows the team to quickly determine if any further changes to the specification could potentially break the Internet Draft when compiled using <code class="highlighter-rouge">kramdown-rfc2629</code> — a tool that enables one to write everything in Markdown and then convert it to XML2RFC XML markup.</p>

<h2 id="what-went-through-our-heads">What went through our heads</h2>

<p>Something that readers have requested in the past is to have a designated section on how the authors came up with research topics such as the type of work we are presenting here. This section will hopefully illustrate where the idea stems from initially.</p>

<p>All the authors of this write-up have lots of experience working on open-source projects on GitHub and have, over the years, learned techniques that simplify the development process for open-source project maintainers. GitHub offers lots of integrations at https://github.com/marketplace, where one particular category stands out: <a href="https://github.com/marketplace/category/continuous-integration">“Continuous integration”</a>. This is where we discovered that due to the way lots of open-source teams strive for complete transparency and openness in the development process, projects were hesitant to hide build log data on continuous-integration platforms. Admittedly, integrations such as Travis CI do offer private profiles as a premium feature on travis-ci.com, but during our research, the vast majority of projects appeared to only use the public instance travis-ci.org — note the “.org” top-level domain.</p>

<p>It is worth noting that continuous-integration services have already been targeted in the past for sensitive information by bug bounty hunters and third-parties as seen in <a href="https://hackerone.com/reports/215625">“A HackerOne employee’s GitHub personal access token exposed in Travis CI build logs”</a> and the <a href="https://www.traviscistatus.com/incidents/3f8mwqxbh127">“API under attack”</a> Travis CI incident report:</p>

<blockquote>
  <p>“We are currently undergoing a distributed attack on our public API that we believe is aimed at revealing GitHub authentication tokens. Countermeasures are holding, and we will update accordingly.”</p>

  <p>— Travis CI (Sep. 2015)</p>
</blockquote>

<p>So much so that platforms such as Travis CI introduced built-in secrets detection to prevent accidental exposure of sensitive information as seen below. <a href="https://docs.travis-ci.com/user/best-practices-security/">[1]</a></p>

<p><img src="./EdO19_files/56799298-f32fa300-6818-11e9-88db-274d183cd1be.png" alt="image"></p>

<p>Travis CI replaces potentially sensitive information with the <code class="highlighter-rouge">[secure]</code> keyword at runtime.</p>

<blockquote>
  <p>To prevent leaks made by these components, we automatically filter secure environment variables and tokens that are longer than three characters at runtime, effectively removing them from the build log, displaying the string <code class="highlighter-rouge">[secure]</code> instead.</p>
</blockquote>

<h2 id="automating-the-boring-tasks">Automating the boring tasks</h2>

<p>Approaching a large attack surface manually, such as the one Travis CI presents, would be an incredibly tedious task. Therefore, we had to work with the available API documentation these CI vendors provide and develop tooling to automate fetching build logs rapidly.</p>

<p>To better illustrate the process of going from a bug bounty program to an extensive data set for further investigation, we will use <a href="https://docs.travis-ci.com/user/developer/">Travis CI’s API documentation</a> as an example.</p>

<p>The initial phase of our process was to fetch bug bounty programs’ GitHub organisations. There were multiple ways of going about doing this, but for the best results, a simple Google search for “company name” and “GitHub” would do the job. Next, we had to check if the GitHub handle was on Travis CI. To make this process smoother, we used a browser bookmarklet that would redirect us from GitHub to Travis CI using the GitHub handle.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">javascript</span><span class="p">:</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="o">=</span><span class="s2">"https://travis-ci.org"</span><span class="o">+</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">;</span>
</code></pre></div></div>

<figure>
	<img src="./EdO19_files/56799313-fd51a180-6818-11e9-9518-4b06e81de2e9.png">
	<figcaption>The bookmarklet would redirect from the GitHub page to Travis CI.</figcaption>
</figure>

<p>If the target was present on GitHub, we hit the projects API endpoint on Travis CI and retrieve a list of all projects.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://api.travis-ci.org/owner/%s/repos?limit=100&amp;offset=%d
</code></pre></div></div>

<p>Travis CI’s API is case sensitive; fortunately, the bookmarklet ensures that you are using the correct handle when issuing API requests. To gather the contents of build logs, we need to hit the build IDs API endpoint and then <code class="highlighter-rouge">/log.txt</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://api.travis-ci.org/repo/%s/builds?limit=100&amp;offset=%d
https://api.travis-ci.org/job/%d/log.txt
</code></pre></div></div>

<p>Now that the contents of all the build logs belonging to the target are stored locally, we can start grepping. Due to the size of the data we were analysing, we resorted to <a href="https://github.com/BurntSushi/ripgrep"><code class="highlighter-rouge">ripgrep</code></a> when sieving through the logs locally.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>rg <span class="nt">-ia</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="nt">-j</span> 12 <span class="nt">--no-filename</span> <span class="nt">--no-line-number</span> <span class="nt">--pretty</span>
</code></pre></div></div>

<p>Besides bug bounty program’s GitHub accounts, the authors also gathered build logs belonging to all members of the GitHub organisation. It turns out that some members were running builds on their account not realising that their secrets were being exposed in the build logs.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="nv">users</span><span class="o">=</span><span class="k">$(</span>curl <span class="nt">-s</span> <span class="nt">-H</span> <span class="s2">"application/vnd.github.hellcat-preview+json"</span> <span class="nt">-H</span> <span class="s2">"Authorization: token </span><span class="nv">$GH_TOKEN</span><span class="s2">"</span> https://api.github.com/orgs/<span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>/members | jq <span class="nt">-r</span> .[].login<span class="k">)</span><span class="p">;</span>

<span class="k">while </span><span class="nb">read</span> <span class="nt">-r</span> hehe<span class="p">;</span> <span class="k">do 
    </span>secretz <span class="nt">-t</span> <span class="s2">"</span><span class="nv">$hehe</span><span class="s2">"</span><span class="p">;</span> 
<span class="k">done</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$users</span><span class="s2">"</span>
</code></pre></div></div>

<p>The team behind this project has decided to refrain from publishing any of the tools built to fetch build logs since we do not want to be directly responsible for any disruptions to CI platforms’ performance. This write-up will inevitably draw more attention to the large attack surface some CI platforms present; therefore, the authors would like to remind the reader, when using the platform’s API, to please take care in not inundating every endpoint with lots of requests at once. We were very cautious not to take down any services during the entire process and would advise others to follow suit.</p>

<h2 id="results-and-notable-findings">Results and notable findings</h2>

<p>Overall, the most impactful findings were predominately GitHub access token leaks. In this section, we will cover four notable reports that our team submitted.</p>

<p>While grepping through the Travis CI build logs of a employee’s account on a public program, we discovered a GitHub access token with read and write access to the GitHub organisation. This token would have allowed us to push code to any of the repositories listed under the GitHub organisation. The program awarded us their highest payout to date according to their HackerOne <em>“Program Statistics”</em>.</p>

<p>To expand our scope, we considered multiple platforms. In a private Bugcrowd program’s Travis CI build log from 2013, we found a GitHub access token and were awarded a P1-severity payout — the highest possible severity score on Bugcrowd. <a href="https://bugcrowd.com/vulnerability-rating-taxonomy">[2]</a></p>

<p>The most surprising response from all the vendors that we reported findings to was Discourse’s bug bounty program. Karim Rahal discovered an employee’s GitHub access token with read and write access to all public repositories under the Discourse GitHub organisation. To demonstrate the potential impact of this issue, we pushed a harmless file to one of the organisation’s least active repositories to not draw too much attention. The file was subsequently <a href="https://github.com/discourse/errorpages/commit/09dc71dc6e20b192a54d9ede0e3ff2c08aa3e400">removed from the repository</a>.</p>

<p><img src="./EdO19_files/56799351-15c1bc00-6819-11e9-8cdb-70e1e119f2c9.png" alt="image"></p>

<p>Discourse awarded Karim the lowest possible bounty of $128. We requested further clarification as to how the team determined the bounty amount, but we have yet to hear back from the Discourse team — that is 60 days without a response. <a href="https://hackerone.com/reports/497669">[3]</a></p>

<p>Another critical bug was discovered on a public cryptocurrency program on HackerOne. This program was using secret variables within Travis CI to create an SSH key. The details for this configuration can be found <a href="https://github.com/dwyl/learn-travis/blob/master/encrypted-ssh-keys-deployment.md#5-encrypt-the-private-key">here</a> and <a href="https://github.com/nelsonic/hello-world-node-http-server/blob/master/.travis.yml#L7-L16">here</a>. After digging through thousands of logs, the following line was detected by a tool Justin Gardner wrote:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-----BEGIN RSA PRIVATE KEY-----
</code></pre></div></div>

<p>A developer had added <code class="highlighter-rouge">cat deploy_key</code> in their CI configuration file which outputted the SSH key in the log. With the SSH key, an attacker could have logged into several deployment servers in the program’s infrastructure. A bounty of $1000 was awarded because the servers were non-production.</p>

<h2 id="tips-and-tricks">Tips and tricks</h2>

<p>Usually, a simple grep for <code class="highlighter-rouge">export</code> statements in the build logs would be a good starting point. The <code class="highlighter-rouge">export</code> command is used for setting environment variables in the log prompt and therefore can expose sensitive information.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ rg -ia "export " -j 12 --no-filename --no-line-number --pretty
</code></pre></div></div>

<p>Of course one should not restrict themselves solely to variables set using the <code class="highlighter-rouge">export</code> command; refining search terms to “token”, “key”, “password”, and “secret” can help uncover specific leaks. To reduce the number of false positives, we recommend appending <code class="highlighter-rouge">=</code> and <code class="highlighter-rouge">:</code> to your search terms.</p>

<p>We encourage readers to create a list of all variables with the <code class="highlighter-rouge">[secure]</code> keyword and then search using those variable names in all projects. This will help you find unsecured instances of sensitive data using common variable naming conventions. Karim Rahal gathered <code class="highlighter-rouge">[secure]</code> variables from 5,302,677 build logs, the 50 most common of which can be seen below.</p>

<figure>
    <img src="./EdO19_files/56803383-c4b6c580-6822-11e9-9807-6ee57563024c.png">
    <figcaption>Full list can be found <a href="https://gist.githubusercontent.com/EdOverflow/8bd2faad513626c413b8fc6e9d955669/raw/06a0ef0fd83920d513c65767aae258ecf8382bdf/gistfile1.txt" target="_blank">here</a>.</figcaption>
</figure>

<p>In addition, setting up continuous monitoring of your favourite bug bounty program’s CI builds, and running your tooling every time the team pushes a new commit to GitHub is a great way to catch exposed secrets in real time before the team has time to act.</p>

<p>Do not restrict yourself to keys and tokens; CI platforms are a great source of information for reconnaissance too. Sieve through the logs to find hidden endpoints and URLs belonging to the target.</p>

<p>Check for CI config files on GitHub to determine what CI integration your target is using. There may be other CI platforms out there that were not covered in this write-up where secrets are exposed.</p>

<p>A fun task that we included in our grep process was to find strings and errors messages commonly associated with missing or broken dependencies. With missing npm packages, this can sometimes lead to code execution by claiming the package name on a remote registry as demonstrated in <a href="https://hackerone.com/reports/399166">https://hackerone.com/reports/399166</a>. Some example error messages include:</p>

<ul>
  <li>“is not in the npm registry.” (<a href="https://www.npmjs.com/">npm</a>)</li>
  <li>“No matching distribution” (<a href="https://pypi.org/">PyPI</a>)</li>
  <li>“Could not find a valid gem” (<a href="https://rubygems.org/">RubyGems</a>)</li>
</ul>

<h2 id="conclusion-and-further-research">Conclusion and further research</h2>

<p>This research has helped us get a better understanding of the large attack surface that continuous-integration services present — almost hidden in plain sight — and has turned out to be extremely fruitful when bug bounty hunting.</p>

<p>Since a reasonably limited amount of platforms were included in this research, future studies and projects could consider covering further CI platforms and integrations.</p>

<p>We applaud platforms such as Travis CI that allow users to hide sensitive environment variables in their logs. In our view, this is a step in the right direction to preventing the type of security leaks that we encountered.</p>

<p>Not only has this work provided us with lots of successful bug bounty stories and valid findings, but it has also shown that collaboration, as seen here with this project, can go a long way while bug bounty hunting. ■</p>

    </div>
  </section>
  <section class="support blog section has-text-centered">
    <div class="content">
      <img src="./EdO19_files/38743788-4217a52e-3f40-11e8-9880-6c0ef4c8e4e7.png" alt="">
      <h1 class="title">Support my work</h1>
      <p>If you enjoy reading my write-ups and would like to support my work,<br>
        please check out my "Buy me a coffee" page.</p>
      <a href="https://www.buymeacoffee.com/edoverflow" class="button is-success is-large" target="_blank" rel="nofollow">☕ Buy me a coffee</a>
  </div></section>
  <section class="support blog section has-text-centered">
    <div class="content">
      <h1 class="title">Subscribe to my newsletter 📨</h1>
      <p>Get updates on new blog posts and regular bug bounty tricks &amp; tips.</p>

      <div id="mc_embed_signup">
        <form action="https://edoverflow.us20.list-manage.com/subscribe/post?u=9644b6e6c0558cb3849b83293&amp;id=daeaf4f8cc" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="">
          <div id="mc_embed_signup_scroll">

            <div class="mc-field-group">
              <label for="mce-EMAIL">Email Address </label>
              <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
            </div>
            <div id="mce-responses" class="clear">
              <div class="response" id="mce-error-response" style="display:none"></div>
              <div class="response" id="mce-success-response" style="display:none"></div>
            </div>
            <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_9644b6e6c0558cb3849b83293_daeaf4f8cc" tabindex="-1" value=""></div>
            <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
          </div>
        </form>
      </div>

    </div>
  </section>



</body></html>